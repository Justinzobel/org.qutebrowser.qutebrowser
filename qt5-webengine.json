{
  "name": "qt5-webengine",
  "buildsystem": "qmake",
  "build-options": {
    "append-path": "/usr/lib/sdk/node14/bin",
    "env": [
      "npm_config_nodedir=/usr/lib/sdk/node14"
    ]
  },
  "make-install-args": [
    "INSTALL_ROOT=/app/scratchdir"
  ],
  "config-opts": [
    "--",
    "-system-ffmpeg",
    "-webengine-icu",
    "-webengine-proprietary-codecs",
    "-webengine-webrtc-pipewire",
    "-webp"
  ],
  "post-install": [
    "cp -r /app/scratchdir/usr/* /app",
    "rm -rf /app/scratchdir",
    "ln -s /app/lib/*/*.so* /app/lib",
    "sed -e 's@PATHS \"${CMAKE_CURRENT_LIST_DIR}/..\" NO_DEFAULT_PATH@PATHS \"${CMAKE_CURRENT_LIST_DIR}/..\" \"/usr/lib/${CMAKE_CXX_LIBRARY_ARCHITECTURE}/cmake/\" NO_DEFAULT_PATH@' -i /app/lib/*/cmake/*/*Config.cmake",
    "sed -e 's@$$QT_MODULE_LIB_BASE@/app/lib@' -i /app/lib/mkspecs/modules/*.pri",
    "mv /app/lib/libexec/QtWebEngineProcess -t /app/bin"
  ],
  "sources": [
    {
      "type": "git",
      "url": "https://invent.kde.org/qt/qt/qtwebengine.git",
      "tag": "v5.15.5-lts",
      "commit": "9711f64c5082040cb76f6da5ef4a16037dbda08f"
    },
    {
      "type": "patch",
      "path": "qt5-webengine-locales.patch"
    },
    {
      "type": "patch",
      "path": "qt5-webengine-resources.patch"
    }
  ],
  "cleanup": [
    "/bin/qwebengine_convert_dict",
    "/lib/mkspecs",
    "/lib/plugins/designer",
    "*.prl",
    "*.cmake",
    "*.pc"
  ],
  "modules": [
    {
      "name": "python2",
      "cleanup": [
        "*"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://www.python.org/ftp/python/2.7.18/Python-2.7.18.tar.xz",
          "sha256": "b62c0e7937551d0cc02b8fd5cb0f544f9405bafc9a54d3808ed4594812edef43"
        }
      ]
    },
    {
      "name": "pciutils",
      "no-autogen": true,
      "make-args": [
        "SHARED=no",
        "ZLIB=no",
        "PREFIX=/app"
      ],
      "post-install": [
        "make install-pcilib",
        "make install-lib"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://mj.ucw.cz/download/linux/pci/pciutils-3.7.0.tar.gz",
          "sha256": "08c27e01030d1fcc700d02bc2ea66c638f58a3d150e45e58852aa82ad4160d84"
        },
        {
          "type": "shell",
          "commands": [
            "sed -i 's@PREFIX=/usr/local@PREFIX=/app@' Makefile"
          ]
        }
      ],
      "cleanup": [
        "/sbin",
        "/share/pci.ids",
        "/share/man"
      ]
    },
    {
      "name": "pipewire-0.2",
      "buildsystem": "meson",
      "config-opts": [
        "-D docs=false",
        "-D gstreamer=disabled",
        "-D man=false",
        "-D systemd=false"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/PipeWire/pipewire/archive/0.2.7.tar.gz",
          "sha256": "bfaa0f6ae6c0791e2e0b59234d399753bf24f1b33dbf587682363a8463dd8df1"
        }
      ],
      "cleanup": [
        "/bin",
        "/etc",
        "/lib/gstreamer-1.0",
        "/lib/pipewire-0.2/libpipewire-module-audio-dsp.so",
        "/lib/pipewire-0.2/libpipewire-module-autolink.so",
        "/lib/pipewire-0.2/libpipewire-module-link-factory.so",
        "/lib/pipewire-0.2/libpipewire-module-mixer.so",
        "/lib/pipewire-0.2/libpipewire-module-portal.so",
        "/lib/pipewire-0.2/libpipewire-module-rtkit.so",
        "/lib/pipewire-0.2/libpipewire-module-spa-monitor.so",
        "/lib/pipewire-0.2/libpipewire-module-spa-node-factory.so",
        "/lib/pipewire-0.2/libpipewire-module-spa-node.so",
        "/lib/pipewire-0.2/libpipewire-module-suspend-on-idle.so",
        "/lib/spa/alsa",
        "/lib/spa/audiomixer",
        "/lib/spa/audiotestsrc",
        "/lib/spa/ffmpeg",
        "/lib/spa/test",
        "/lib/spa/v4l2",
        "/lib/spa/videotestsrc",
        "/lib/spa/volume"
      ]
    }
  ]
}
